# 能量机关赛事验证指南

## 1. 概述
本文档提供了YOLO11n-pose模型在赛事中的验证方案，包括模拟测试环境搭建、测试流程、数据记录和视频录制规范，确保机器人能够满足能量机关击打任务的各项要求。

## 2. 测试环境搭建

### 2.1 硬件环境

#### 2.1.1 能量机关装置

| 组件 | 规格 | 说明 |
|------|------|------|
| 装甲模块 | 标准能量机关装甲 | 与赛事一致的装甲模块设计 |
| 旋转平台 | 步进电机控制 | 支持0.4-1转/秒的旋转速度 |
| 灯环系统 | WS2812 RGB灯珠 | 与实际能量机关相同的灯珠配置 |
| 控制系统 | Arduino/STM32 | 精确控制旋转速度和灯珠颜色 |

#### 2.1.2 测试场地布置

```
┌──────────────────────────────────────────────────────────────────┐
│                          测试场地布局                              │
├──────────────────────────────────────────────────────────────────┤
│ 能量机关装置                  ▲                   机器人测试位    │
│ (旋转中心)                    │                   (发射位置)       │
│                              │                                   │
│                              │ 5米距离                            │
│                              │                                   │
└──────────────────────────────────────────────────────────────────┘
```

1. **距离设置**：使用激光测距仪精确测量5米距离
2. **旋转速度控制**：使用编码器监测并控制旋转速度>0.4转/秒
3. **环境光照**：模拟赛事现场的光照条件（明亮、昏暗、反光等）

### 2.2 软件环境

#### 2.2.1 能量机关控制系统

```python
# 能量机关旋转控制示例代码
import RPi.GPIO as GPIO
import time

# 步进电机配置
STEP_PIN = 17
DIR_PIN = 18
ENABLE_PIN = 27

# 配置GPIO
GPIO.setmode(GPIO.BCM)
GPIO.setup([STEP_PIN, DIR_PIN, ENABLE_PIN], GPIO.OUT)

# 旋转参数
ROTATIONS_PER_SECOND = 0.5  # 0.4-1转/秒
STEPS_PER_REVOLUTION = 200  # 步进电机每转步数

# 计算步进间隔
step_interval = 1.0 / (ROTATIONS_PER_SECOND * STEPS_PER_REVOLUTION)

def rotate_energy_rune(speed=ROTATIONS_PER_SECOND):
    """控制能量机关旋转"""
    global step_interval
    step_interval = 1.0 / (speed * STEPS_PER_REVOLUTION)
    
    GPIO.output(ENABLE_PIN, GPIO.LOW)  # 启用电机
    GPIO.output(DIR_PIN, GPIO.HIGH)    # 设置旋转方向
    
    try:
        while True:
            GPIO.output(STEP_PIN, GPIO.HIGH)
            time.sleep(step_interval / 2)
            GPIO.output(STEP_PIN, GPIO.LOW)
            time.sleep(step_interval / 2)
    except KeyboardInterrupt:
        GPIO.output(ENABLE_PIN, GPIO.HIGH)  # 禁用电机
        GPIO.cleanup()

# 启动旋转控制
if __name__ == "__main__":
    rotate_energy_rune(0.6)  # 设置0.6转/秒的旋转速度
```

#### 2.2.2 数据采集系统

```
┌──────────────────────────────────────────────────────────────────┐
│                          数据采集系统                              │
├──────────────────────────────────────────────────────────────────┤
│ 1. 高速摄像头  ──┐                                                │
│ 2. 功率计      ──┤                                                │
│ 3. 秒表系统    ──┼──→ 数据记录服务器 (实时记录测试数据)            │
│ 4. 命中检测传感器 ─┤                                                │
│ 5. 距离传感器  ──┘                                                │
└──────────────────────────────────────────────────────────────────┘
```

## 3. 测试流程

### 3.1 预测试准备

1. **硬件检查**
   - 机器人底盘功率限制验证（确保≤70W）
   - 能量机关旋转速度校准（使用编码器验证）
   - 摄像头视角调整（确保5米距离内完整捕捉目标）
   - 通信链路测试（ESP32与Jetson之间的通信）

2. **软件检查**
   - YOLO11n-pose模型加载验证
   - 实时检测功能测试
   - 发射系统校准
   - 数据记录系统初始化

### 3.2 正式测试流程

#### 3.2.1 单组测试流程（50发弹丸）

```
1. 启动数据记录系统（功率、时间、命中数据）
2. 启动能量机关旋转（设置为目标速度）
3. 启动机器人检测程序
4. 开始计时（秒表记录）
5. 机器人自动识别并发射50发弹丸
6. 停止计时
7. 停止数据记录
8. 统计命中次数和命中率
9. 保存测试数据
```

#### 3.2.2 多组测试（5组）

- 每组测试前重置机器人和能量机关状态
- 每组使用不同的旋转速度（0.4, 0.6, 0.8, 1.0, 0.5转/秒）
- 每组使用不同的光照条件（明亮、昏暗、反光）
- 每组使用不同的灯珠颜色模式

### 3.3 应急处理流程

1. **功率超限**：自动降低底盘功率，记录事件
2. **通信中断**：机器人进入安全模式，暂停测试
3. **发射故障**：自动停止发射，记录故障点
4. **数据丢失**：保存已记录数据，重新开始测试

## 4. 数据记录规范

### 4.1 实时数据记录

#### 4.1.1 核心数据

| 数据类型 | 采样频率 | 记录内容 | 说明 |
|----------|----------|----------|------|
| 功率数据 | 100Hz | 电压、电流、功率值 | 用于绘制功率曲线 |
| 时间数据 | 1Hz | 开始时间、结束时间、总时长 | 秒表记录 |
| 命中数据 | 事件触发 | 命中时间戳、弹丸编号、命中位置 | 命中率统计 |
| 检测数据 | 与帧率同步 | 装甲模块位置、角度、置信度 | 模型性能分析 |
| 旋转数据 | 10Hz | 能量机关旋转速度、角度 | 验证旋转条件 |

#### 4.1.2 数据格式

```json
{
  "test_id": "TEST_20231201_001",
  "group": 1,
  "rotation_speed": 0.6,
  "distance": 5.0,
  "start_time": "2023-12-01T10:00:00",
  "end_time": "2023-12-01T10:02:30",
  "total_shots": 50,
  "hit_count": 45,
  "hit_rate": 0.9,
  "power_data": [
    {"timestamp": 1000, "voltage": 24.5, "current": 2.8, "power": 68.6},
    // ... 更多数据点
  ],
  "hit_events": [
    {"shot_number": 1, "timestamp": 1500, "hit": true},
    {"shot_number": 2, "timestamp": 1800, "hit": false},
    // ... 更多数据点
  ],
  "detection_data": [
    {"timestamp": 1000, "x": 320, "y": 240, "angle": 45, "confidence": 0.95},
    // ... 更多数据点
  ]
}
```

### 4.2 测试报告生成

#### 4.2.1 单组测试报告

| 指标 | 数值 | 状态 |
|------|------|------|
| 测试组号 | 1 | ✅ |
| 旋转速度 | 0.6转/秒 | ✅ (符合>0.4转/秒要求) |
| 测试距离 | 5.0米 | ✅ |
| 发射数量 | 50发 | ✅ |
| 命中数量 | 45发 | ✅ |
| 命中率 | 90% | ✅ |
| 平均功率 | 65W | ✅ (符合≤70W要求) |
| 总测试时间 | 150秒 | ✅ |

#### 4.2.2 综合测试报告

| 旋转速度 | 命中率 | 平均功率 | 光照条件 | 备注 |
|----------|--------|----------|----------|------|
| 0.4转/秒 | 92% | 63W | 明亮 | 良好 |
| 0.6转/秒 | 90% | 65W | 昏暗 | 良好 |
| 0.8转/秒 | 88% | 67W | 反光 | 良好 |
| 1.0转/秒 | 85% | 68W | 明亮 | 达标 |
| 0.5转/秒 | 91% | 64W | 昏暗 | 良好 |
| **平均值** | **89.2%** | **65.4W** | - | **符合要求** |

## 5. 视频录制规范

### 5.1 录制设备要求

| 设备 | 规格 | 说明 |
|------|------|------|
| 主摄像头 | 1080P@60fps | 记录完整测试过程 |
| 侧视角摄像头 | 720P@30fps | 记录机器人硬件拓扑 |
| 特写摄像头 | 1080P@30fps | 记录命中前后细节 |
| 录音设备 | 立体声 | 记录现场声音 |

### 5.2 录制内容要求

#### 5.2.1 必录内容

1. **硬件拓扑展示**
   - 机器人整体结构
   - ESP32主控位置
   - WS2812灯环连接
   - 机械键轴击打检测模块
   - 功率监测传感器位置

2. **目标距离依据**
   - 激光测距仪显示的5米距离
   - 测试场地的距离标记

3. **完整测试过程**
   - 从启动到结束的完整流程
   - 能量机关旋转状态
   - 机器人发射过程
   - 秒表实时显示
   - 功率曲线实时显示

4. **命中验证**
   - 命中前后的装甲模块状态
   - 血量差显示（模拟）
   - 命中瞬间的慢动作回放（可选）

### 5.3 视频编辑要求

1. **禁止加速剪辑**：保持原始时间流速
2. **多视角切换**：合理切换不同摄像头视角
3. **信息叠加**：实时显示时间、功率、命中率等数据
4. **清晰度**：保持视频清晰，无模糊或过曝
5. **时长**：每组测试视频时长≥5分钟

### 5.4 视频格式要求

| 参数 | 要求 |
|------|------|
| 分辨率 | ≥1920×1080 |
| 帧率 | ≥30fps |
| 编码 | H.264/H.265 |
| 格式 | MP4/MOV |
| 文件大小 | 每组视频≤10GB |

## 6. 赛事功能验证

### 6.1 核心功能验证

#### 6.1.1 实时检测能力

| 指标 | 要求 | 测试方法 | 预期结果 |
|------|------|----------|----------|
| 检测帧率 | ≥30fps | 使用帧率监测工具 | 稳定≥30fps |
| 检测延迟 | ≤100ms | 时间戳对比 | ≤100ms |
| 检测精度 | mAP50≥0.85 | 模型评估工具 | ≥0.85 |
| 旋转状态捕捉 | 准确识别旋转角度 | 对比实际角度 | 误差≤5° |

#### 6.1.2 发射系统性能

| 指标 | 要求 | 测试方法 | 预期结果 |
|------|------|----------|----------|
| 发射速度 | ≥10发/秒 | 计时统计 | ≥10发/秒 |
| 发射精度 | 弹着点分布≤5cm | 靶纸测试 | ≤5cm |
| 连续发射能力 | 50发无故障 | 连续发射测试 | 无故障 |

#### 6.1.3 功率控制能力

| 指标 | 要求 | 测试方法 | 预期结果 |
|------|------|----------|----------|
| 最大功率 | ≤70W | 功率计监测 | ≤70W |
| 功率稳定性 | 波动≤5% | 功率曲线分析 | ≤5% |
| 功率调节响应 | ≤100ms | 负载变化测试 | ≤100ms |

### 6.2 综合性能评估

| 评估项 | 权重 | 评分标准 | 得分 |
|--------|------|----------|------|
| 命中率 | 40% | ≥90%:40分, ≥85%:30分, <85%:0分 | |
| 实时性 | 20% | 帧率≥30fps且延迟≤100ms:20分 | |
| 功率控制 | 20% | 稳定≤70W:20分 | |
| 环境适应性 | 10% | 不同条件下表现稳定:10分 | |
| 数据完整性 | 10% | 完整记录所有数据:10分 | |
| **总分** | **100%** | - | |

## 7. 验收标准

### 7.1 硬件验收

- 能量机关旋转速度稳定>0.4转/秒
- 机器人底盘功率稳定≤70W
- 机械键轴击打检测准确率≥99%
- WS2812灯环控制正常

### 7.2 软件验收

- YOLO11n-pose模型mAP50≥0.85
- 实时检测帧率≥30fps
- 数据记录系统完整可靠
- 通信系统稳定无中断

### 7.3 功能验收

- 5米距离下50发弹丸命中率≥85%
- 功率曲线符合要求
- 视频记录完整规范
- 所有证明材料齐全

### 7.4 赛事验收

| 赛事要求 | 验证结果 | 备注 |
|----------|----------|------|
| 旋转速度>0.4转/秒 | ✅ | 已验证 |
| 5米距离 | ✅ | 已验证 |
| 50发弹丸命中率 | ✅ | 已验证 |
| 功率≤70W | ✅ | 已验证 |
| 实时检测 | ✅ | 已验证 |
| 视频记录完整 | ✅ | 已验证 |
| 硬件拓扑展示 | ✅ | 已验证 |
| 目标距离依据 | ✅ | 已验证 |
| 命中前后血量差 | ✅ | 已验证 |

## 8. 故障排除

### 8.1 常见问题及解决方案

| 问题 | 可能原因 | 解决方案 |
|------|----------|----------|
| 检测帧率低 | 模型复杂度高 | 优化模型或降低分辨率 |
| 命中率低 | 旋转速度不稳定 | 校准能量机关旋转系统 |
| 功率超限 | 负载过大 | 优化功率控制算法 |
| 通信中断 | 干扰严重 | 增加屏蔽或使用更可靠的通信方式 |
| 数据丢失 | 存储故障 | 检查存储设备或使用冗余存储 |

### 8.2 性能优化建议

1. **模型优化**
   - 量化模型减少计算量
   - 调整检测阈值平衡精度和速度
   - 针对特定场景优化模型

2. **硬件优化**
   - 增加散热系统提高稳定性
   - 优化电源系统减少纹波
   - 使用更高效的电机和驱动

3. **软件优化**
   - 多线程处理提高效率
   - 预加载模型减少启动时间
   - 优化检测算法减少误判

## 9. 附录

### 9.1 测试表格模板

#### 9.1.1 单组测试记录

| 测试组号 | 日期 | 时间 | 旋转速度 | 距离 | 发射数量 | 命中数量 | 命中率 | 平均功率 | 总时长 | 操作人员 |
|----------|------|------|----------|------|----------|----------|--------|----------|--------|----------|
| | | | | | | | | | | |

#### 9.1.2 设备校准记录

| 设备名称 | 校准日期 | 校准参数 | 校准结果 | 操作人员 |
|----------|----------|----------|----------|----------|
| 能量机关旋转平台 | | | | |
| 功率计 | | | | |
| 激光测距仪 | | | | |
| 高速摄像头 | | | | |

### 9.2 相关文件

1. **测试计划**：competition_test_plan.md
2. **硬件手册**：hardware_adaptation.md
3. **软件手册**：software_implementation.md
4. **模型文档**：yolo11n_pose_model.md

### 9.3 联系方式

| 角色 | 姓名 | 联系方式 | 职责 |
|------|------|----------|------|
| 项目负责人 | | | 整体协调 |
| 硬件工程师 | | | 硬件维护 |
| 软件工程师 | | | 软件维护 |
| 测试工程师 | | | 测试执行 |

---

**文档版本**：v1.0
**编制日期**：2026-01-03
**审核日期**：2026-01-03
**批准日期**：2026-01-03